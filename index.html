<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>R.GAME — متجر حسابات وشحن ألعاب</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;700;900&display=swap" rel="stylesheet">
<style>
:root{--accent:#ff6b6b;--dark:#0f1724;--muted:#9aa4b2;--success:#28a745;--orange:#ff8a00}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{font-family:'Tajawal',sans-serif;background:#07101a;color:#fff;line-height:1.5}
header{background:linear-gradient(90deg,rgba(255,255,255,0.02),transparent);padding:12px 18px;position:sticky;top:0;z-index:60}
.container{max-width:1200px;margin:0 auto;padding:0 16px;position:relative}
.nav{display:flex;gap:12px;align-items:center;position:relative}
.logo{display:flex;align-items:center;gap:10px}
.logo img{width:48px;height:48px;border-radius:10px;object-fit:cover}
.brand{font-weight:900}
.search{flex:1}
.search input{width:100%;padding:10px 12px;border-radius:10px;border:0;background:#0b1116;color:#fff}
.btn{background:var(--accent);padding:10px 14px;border-radius:10px;color:#111;font-weight:800;border:0;cursor:pointer}
.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px;border-radius:8px;color:#fff;cursor:pointer}

/* زر عروض الشحن في أقصى اليسار */
.offers-btn {
  margin-right: auto; /* يدفع الزر نحو اليسار */
  background: #0b1220;
  border: 1px solid rgba(255,255,255,0.04);
  padding: 8px 14px;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 700;
  color: var(--accent);
  transition: background 0.2s;
}
.offers-btn:hover {
  background: rgba(255,107,107,0.15);
}


/* Grid */
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px;margin-top:20px}
.card{background:linear-gradient(180deg,#0b1116,#07101a);padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
.card img{width:100%;height:140px;object-fit:cover;border-radius:8px}
.card h3{font-size:16px;margin:8px 0 4px}
.price{font-weight:800;color:var(--accent)}
.meta{color:var(--muted);font-size:13px}

/* Cart drawer */
.cart-drawer{position:fixed;right:0;top:0;height:100%;width:360px;background:#07101a;box-shadow:-20px 0 50px rgba(0,0,0,0.6);transform:translateX(110%);transition:transform .28s;z-index:80;padding:16px}
.cart-drawer.open{transform:translateX(0)}
.cart-item{display:flex;gap:10px;align-items:center;padding:8px 0;border-bottom:1px dashed rgba(255,255,255,0.03)}
.cart-item img{width:56px;height:46px;object-fit:cover;border-radius:6px}

/* Checkout modal */
#checkoutModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.85);align-items:center;justify-content:center;z-index:90}
#checkoutModal .modal-content{background:#111;padding:24px;border-radius:12px;width:90%;max-width:720px}
#checkoutModal h3{margin-top:0}
#checkoutModal label{display:block;margin-top:12px;margin-bottom:6px}
#checkoutModal input, #checkoutModal select{width:100%;padding:10px;border-radius:8px;border:0;background:#0b1116;color:#fff;margin-bottom:12px}
#checkoutModal .order-btn{background:var(--success);color:#fff;padding:12px 16px;font-weight:700;border:0;border-radius:10px;cursor:pointer;width:100%;margin-top:10px}

/* Full screen shipping overlay */
#shippingOffersOverlay{
  display:none;
  position:fixed;
  inset:0;
  z-index:100;
  background:linear-gradient(180deg, rgba(0,0,0,0.75), rgba(0,0,0,0.85));
  backdrop-filter:blur(6px);
  align-items:center;
  justify-content:center;
  padding:20px;
}
#shippingOffersOverlay.open{display:flex}
.offers-card{
  width:100%;
  max-width:1100px;
  background:linear-gradient(180deg,#07101a,#05070a);
  border-radius:12px;
  border:1px solid rgba(255,255,255,0.03);
  padding:22px;
  position:relative;
  box-shadow:0 10px 40px rgba(0,0,0,0.6);
  animation:popIn .28s ease;
  direction:rtl;
}
@keyframes popIn{from{opacity:0;transform:translateY(10px) scale(.99)}to{opacity:1;transform:translateY(0) scale(1)}}

/* Close X red top-left */
.offers-close{
  position:absolute;
  left:12px;
  top:12px;
  background:#ff3b3b;
  color:#fff;
  width:40px;height:40px;border-radius:8px;border:0;font-weight:900;cursor:pointer;
  display:flex;align-items:center;justify-content:center;font-size:18px;
  box-shadow:0 6px 18px rgba(255,59,59,0.12);
  z-index:105;
}

/* offers list */
.offers-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:14px}
.offer{background:linear-gradient(180deg,#061018,#07101a);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
.offer h4{margin-bottom:6px}
.offer .offer-price{font-weight:900;color:var(--accent);margin-bottom:8px}
.offer .offer-btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px;border-radius:8px;color:#fff;cursor:pointer}

/* Small choice modal (داخل overlay) */
#offerChoiceModal{
  display:none;
  position:fixed;
  inset:0;
  z-index:110;
  align-items:center;
  justify-content:center;
}
.choice-box{
  background:#0b1116;padding:18px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);width:320px;max-width:90%;
  text-align:center;animation:scaleIn .18s ease;
}
@keyframes scaleIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
.choice-box button{width:100%;padding:10px;border-radius:8px;border:0;margin-top:8px;font-weight:800;cursor:pointer}

/* Toast message on far right */
#rightToast{
  position:fixed;
  right:16px;
  top:20px;
  z-index:120;
  background:linear-gradient(90deg,var(--orange),#ffb46b);
  color:#111;
  padding:12px 16px;
  border-radius:10px;
  box-shadow:0 10px 30px rgba(0,0,0,0.45);
  display:none;
  transform:translateX(20px);
  opacity:0;
}
#rightToast.show{
  display:block;
  animation:toastIn .4s ease forwards;
}
@keyframes toastIn{to{transform:translateX(0);opacity:1}}
@keyframes toastOut{to{transform:translateX(20px);opacity:0}}

/* responsive tweaks */
@media (max-width:720px){
  .offers-card{padding:16px}
  .offers-close{left:8px;top:8px;width:36px;height:36px}
  .choice-box{width:90%}
}
</style>
</head>
<body>
<header>
  <div class="container nav">
    <div class="logo">
      <img src="https://images.unsplash.com/photo-1605902711622-cfb43c44367e?q=80&w=400&auto=format&fit=crop&ixlib=rb-4.0.3&s=placeholder" alt="logo">
      <div class="brand">R.GAME</div>
    </div>

    <div class="search">
      <input id="searchInput" placeholder="ابحث عن اللعبة أو الحساب أو طريقة الشحن...">
    </div>

    <button class="btn" id="cartBtn">عربة (0)</button>

    <!-- زر عروض الشحن على أقصى اليسار -->
    <button class="offers-btn" id="offersBtn">عروض الشحن</button>
<a href="https://salah-site.github.io/R_s-SHOP/" target="_blank" 
   style="margin-right:8px;background:#0a0;border:1px solid #0f0;padding:8px 14px;border-radius:10px;color:#fff;font-weight:700;text-decoration:none;">
   المتجر الجديد
</a>
  </div>
</header>

<main class="container">
  <section>
    <h2 style="margin-top:24px;color:var(--accent)">منتجات مميزة</h2>
    <div class="grid" id="productsGrid"></div>
  </section>

  <div id="checkoutModal">
    <div class="modal-content">
      <h3>إتمام الطلب</h3>
      <div id="checkoutDetails" style="color:var(--muted)"></div>
      <label>الاسم الكامل</label>
      <input type="text" id="fullName" required>
      <label>البريد الإلكتروني</label>
      <input type="email" id="email" required>
      <label>طريقة الدفع</label>
      <select id="paymentMethod">
        <option value="online">دفع الكتروني</option>
        <option value="cod">دفع عند الاستلام</option>
      </select>
      <button class="order-btn" onclick="submitOrder()">طلب المنتج</button>
      <button class="secondary" style="margin-top:8px;" onclick="closeCheckout()">إلغاء</button>
    </div>
  </div>
</main>

<!-- Cart drawer -->
<div class="cart-drawer" id="cartDrawer">
  <h3>عربتك</h3>
  <div id="cartItems"></div>
  <div style="margin-top:12px;border-top:1px solid rgba(255,255,255,0.03);padding-top:12px">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>الإجمالي</div>
      <div id="cartTotal" style="font-weight:800;color:var(--accent)">0 د.ج</div>
    </div>
    <div style="margin-top:12px;display:flex;gap:8px">
      <button class="btn" onclick="openCheckout()">تابع للدفع</button>
      <button class="secondary" onclick="clearCart()">تفريغ</button>
    </div>
  </div>
</div>

<!-- Shipping Offers Fullscreen Overlay -->
<div id="shippingOffersOverlay" aria-hidden="true">
  <div class="offers-card" role="dialog" aria-modal="true">
    <button class="offers-close" id="closeOffersBtn" title="إغلاق">✕</button>
    <h2 style="color:var(--accent);margin-bottom:6px">شحن فري فاير — عروض الشحن</h2>
    <p style="color:var(--muted);margin-bottom:14px">اختار العرض لي تحب، وبعدين اضغط "أضف للعربة". بعد الإضافة ستظهر نافذة اختيار الشحن.</p>

    <div class="offers-list" id="offersList">
      <!-- عروض جاهزة يتم توليدها بالـJS -->
    </div>

  </div>
</div>

<script>
function showDiscordOffers(){
  document.getElementById('shippingOffersOverlay').style.display='none';
  document.getElementById('discordOffers').style.display='flex';
}

function closeDiscordOffers(){
  document.getElementById('discordOffers').style.display='none';
}

let lastDiscordOffer = null;

function onDiscordOfferAdd(id){
  lastDiscordOffer = id; // تخزين آخر عرض
  document.getElementById('discordOfferChoiceModal').style.display='flex';
}

function closeDiscordOfferChoice(){
  document.getElementById('discordOfferChoiceModal').style.display='none';
}

document.getElementById('discordChargeOfferBtn').addEventListener('click',()=>finalizeDiscordOffer('شحن العروض'));
document.getElementById('discordChargeGemsBtn').addEventListener('click',()=>finalizeDiscordOffer('شحن الجواهر'));

function finalizeDiscordOffer(type){
  if(!lastDiscordOffer) return;
  let title='', price=0;
  if(lastDiscordOffer==='discord1'){ title='نيترو Gming + ضمان المدة'; price=2500;}
  else if(lastDiscordOffer==='discord2'){ title='نيترو باسيك'; price=1500;}
  else if(lastDiscordOffer==='discord3'){ title='عروض أخرى'; price=0;}

  cart.push({id:lastDiscordOffer,title:title+' — '+type,price:price,qty:1,img:'https://i.imgur.com/placeholder.png',isOffer:true});
  updateCartUI();
  closeDiscordOfferChoice();
  alert('تمت إضافة العرض للعربة');
}
</script>
  </div>
</div>

<!-- Small choice modal -->
<div id="offerChoiceModal" aria-hidden="true">
  <div class="choice-box" id="choiceBox">
    <h3 style="margin-bottom:8px">اختر نوع الشحن</h3>
    <div style="color:var(--muted);font-size:14px;margin-bottom:8px">شحن العروض أو شحن الجواهر</div>
    <button id="chargeOfferBtn" style="background:var(--accent);color:#111">شحن العروض</button>
    <button id="chargeGemsBtn" style="background:var(--orange);color:#111">شحن الجواهر</button>
    <button class="secondary" onclick="closeOfferChoice()" style="margin-top:8px">إلغاء</button>
  </div>
</div>

<!-- Toast message on far right -->
<div id="rightToast">يرجى إكمال طلبك من خلال الضغط على العربة وتأكيد الدفع لإكمال العملية</div>

<!-- SDK EmailJS -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
emailjs.init("H1UCQ3TNmVxTTUxaJ"); // ضع Public Key الخاص بك
</script>

<script>
/* === بيانات المنتجات الأساسية === */
const products=[
  {id:1,title:'حساب فري فاير - مستوى 59 + سكنات',price:4500,meta:'تسليم فوري',img:'https://i.pinimg.com/736x/e6/40/55/e6405574938e46795f8a2d86f95fe416.jpg'},
  {id:2,title:'حساب Steam - ألعاب متعددة',price:7200,meta:'2FA مفعل',img:'https://i.pinimg.com/736x/12/c0/c9/12c0c9229040937d043d01f74b1d3f4b.jpg'},
  {id:3,title:'حساب GTA V RP مع كل الحقوق',price:1000,meta:'تسليم فوري',img:'https://i.imgur.com/g5tXGRL.jpeg'},
  {id:4, title:'حسابات تيك توك', price:0, meta:'تسليم فوري', img:'https://i.pinimg.com/736x/d8/a2/1e/d8a21e756173befdf886a0d15f6afac6.jpg', isTikTok:true}
];

/* === عروض الشحن (تقدر تعدل القيم) === */
const shippingOffers = [
  {id:'s1', title:'100 جوهرة', price:250, meta:'سريع', img:'https://i.pinimg.com/1200x/49/e4/3d/49e43dc233313089659d5a7084e3f660.jpg'},
  {id:'s2', title:'500 جوهرة', price:1000, meta:'الأكثر مبيعاً', img:'https://i.pinimg.com/1200x/49/e4/3d/49e43dc233313089659d5a7084e3f660.jpg'},
  {id:'s3', title:'1000 جوهرة', price:1800, meta:'عرض خاص', img:'https://i.pinimg.com/1200x/49/e4/3d/49e43dc233313089659d5a7084e3f660.jpg'},
  {id:'s4', title:'عرض VIP (2000 جوهرة)', price:3000, meta:'أوفر', img:'https://i.pinimg.com/1200x/49/e4/3d/49e43dc233313089659d5a7084e3f660.jpg'}
];

const cart=[];
let lastAddedOffer = null;

/* === رندر المنتجات الرئيسية === */
function renderProducts(list){
  const grid=document.getElementById('productsGrid'); grid.innerHTML='';
  list.forEach(p=>{
    let priceDisplay = p.isTikTok ? 'حدد المتابعين' : p.price+' د.ج';
    const card=document.createElement('div'); card.className='card';
    card.innerHTML=`<img src="${p.img}" alt="${p.title}"><h3>${p.title}</h3><div class='meta'>${p.meta}</div>
      <div style='display:flex;justify-content:space-between;align-items:center;margin-top:8px'>
        <div class='price'>${priceDisplay}</div>
        <div><button class='btn' onclick='addToCart(${p.id})'>أضف للعربة</button></div>
      </div>`;
    grid.appendChild(card);
  });
}

/* === منطق العربة === */
function addToCart(id){
  const p = products.find(x => x.id === id);

  if(p.isTikTok){
    const qty = prompt("اختر عدد المتابعين:\n100\n500\n1000\n5000\n10000\n50000");
    if(!qty || isNaN(qty)) return;
    const price = parseInt(qty) * 1; // السعر لكل متابع 1 د.ج
    cart.push({id:p.id,title:p.title + " - " + qty + " متابع",price:price,qty:1,img:p.img});
  } else {
    const exists = cart.find(i => i.id === id && !i.isOffer);
    if(exists) exists.qty++;
    else cart.push({id:p.id,title:p.title,price:p.price,qty:1,img:p.img});
  }

  localStorage.setItem('lastProduct', JSON.stringify(p));
  updateCartUI();
  openCart();
}

function updateCartUI(){
  document.getElementById('cartBtn').innerText=`عربة (${cart.reduce((s,i)=>s+i.qty,0)})`;
  const container=document.getElementById('cartItems'); container.innerHTML='';
  let total=0;
  cart.forEach(item=>{
    total+=item.price*item.qty;
    const el=document.createElement('div'); el.className='cart-item';
    el.innerHTML=`<img src='${item.img}'><div style='flex:1'><div>${item.title}</div><div class='meta'>${item.price} د.ج x ${item.qty}</div></div>`;
    container.appendChild(el);
  });
  document.getElementById('cartTotal').innerText=total+' د.ج';
}

function openCart(){document.getElementById('cartDrawer').classList.add('open');}
function closeCart(){document.getElementById('cartDrawer').classList.remove('open');}
document.getElementById('cartBtn').addEventListener('click',()=>{document.getElementById('cartDrawer').classList.toggle('open');});
function clearCart(){cart.length=0;updateCartUI();}

/* === Checkout === */
function openCheckout(){
  if(cart.length===0){alert('العربة فارغة'); return;}
  document.getElementById('checkoutModal').style.display='flex';
  const details=cart.map(i=>`${i.title} x${i.qty} — ${i.price*i.qty} د.ج`).join('\n');
  document.getElementById('checkoutDetails').innerText=details;
  const last=JSON.parse(localStorage.getItem('lastProduct'));
  if(last){document.getElementById('fullName').value=last.title;}
}

function closeCheckout(){document.getElementById('checkoutModal').style.display='none';}

function submitOrder() {
  const name = document.getElementById('fullName').value;
  const email = document.getElementById('email').value;
  const method = document.getElementById('paymentMethod').value;

  if(!name || !email){
    alert('الرجاء ملء جميع الحقول');
    return;
  }

  const productNames = cart.map(i => i.title).join(", ");
  const productPrices = cart.map(i => i.price + " د.ج").join(", ");

  emailjs.send(
    "service_jae833s",
    "template_ja011yl",
    {
      user_name: name,
      user_email: email,
      payment_method: method,
      product_name: productNames,
      product_price: productPrices
    }
  ).then(() => {
    alert(`شكراً ${name}! تم طلب المنتج بنجاح.`);
  }, (err) => {
    alert("حدث خطأ أثناء الإرسال: " + err.text);
  });

  clearCart();
  closeCheckout();
  closeCart();
}

/* === Search === */
document.getElementById('searchInput').addEventListener('input',function(e){
  const q=e.target.value.trim();
  if(!q) renderProducts(products);
  else renderProducts(products.filter(p=>p.title.includes(q)||p.meta.includes(q)));
});

/* === Shipping offers overlay logic === */
const offersBtn = document.getElementById('offersBtn');
const shippingOverlay = document.getElementById('shippingOffersOverlay');
const closeOffersBtn = document.getElementById('closeOffersBtn');
const offersList = document.getElementById('offersList');
const offerChoiceModal = document.getElementById('offerChoiceModal');
const chargeOfferBtn = document.getElementById('chargeOfferBtn');
const chargeGemsBtn = document.getElementById('chargeGemsBtn');
const rightToast = document.getElementById('rightToast');

offersBtn.addEventListener('click', openShippingOverlay);
closeOffersBtn.addEventListener('click', closeShippingOverlay);

/* render offers inside overlay */
function renderOffers(){
  offersList.innerHTML = '';
  shippingOffers.forEach(o=>{
    const el = document.createElement('div'); el.className='offer';
    el.innerHTML = `
      <img src="${o.img}" style="width:100%;height:120px;object-fit:cover;border-radius:6px;margin-bottom:8px">
      <h4>${o.title}</h4>
      <div class="meta">${o.meta}</div>
      <div class="offer-price">${o.price} د.ج</div>
      <div style="display:flex;gap:8px">
        <button class="offer-btn" onclick='onOfferAdd("${o.id}")'>أضف للعربة</button>
      </div>
    `;
    offersList.appendChild(el);
  });
}
renderOffers();

function openShippingOverlay(){
  shippingOverlay.classList.add('open');
  shippingOverlay.setAttribute('aria-hidden','false');
}
function closeShippingOverlay(){
  shippingOverlay.classList.remove('open');
  shippingOverlay.setAttribute('aria-hidden','true');
}

/* عند الضغط على أضف للعربة داخل عروض الشحن -> تفتح نافذة اختيار */
function onOfferAdd(offerId){
  lastAddedOffer = shippingOffers.find(o=>o.id===offerId);
  openOfferChoice();
}

/* نافذة اختيار الشحن الصغيرة */
function openOfferChoice(){
  offerChoiceModal.style.display = 'flex';
  offerChoiceModal.setAttribute('aria-hidden','false');
}
function closeOfferChoice(){
  offerChoiceModal.style.display = 'none';
  offerChoiceModal.setAttribute('aria-hidden','true');
}

/* عند اختيار "شحن العروض" أو "شحن الجواهر" */
chargeOfferBtn.addEventListener('click', () => finalizeOfferAdd('شحن العروض'));
chargeGemsBtn.addEventListener('click', () => finalizeOfferAdd('شحن الجواهر'));

function finalizeOfferAdd(type){
  if(!lastAddedOffer) return;
  const item = {
    id: lastAddedOffer.id,
    title: `${lastAddedOffer.title} — ${type}`,
    price: lastAddedOffer.price,
    qty: 1,
    img: lastAddedOffer.img,
    isOffer: true
  };
  cart.push(item);
  updateCartUI();
  closeOfferChoice();
  // عرض رسالة برتقالية على أقصى يمين الشاشة 10 ثواني
  showRightToast();
}

/* Toast logic: يظهر 10 ثواني ثم يختفي بأنيميشن ناعم */
let toastTimeout = null;
function showRightToast(){
  if(toastTimeout) { clearTimeout(toastTimeout); toastTimeout = null; }
  rightToast.classList.add('show');
  rightToast.style.animation = 'none';
  // إعادة تهيئة لبدء الانيميشن
  void rightToast.offsetWidth;
  rightToast.style.animation = '';
  rightToast.style.display = 'block';

  // بعد 10 ثواني نعمل أنيميشن خروج ثم نخفيه
  toastTimeout = setTimeout(()=> {
    rightToast.style.animation = 'toastOut .5s ease forwards';
    // بعد انتهاء الأنيميشن نخفي العنصر
    setTimeout(()=> {
      rightToast.classList.remove('show');
      rightToast.style.display = 'none';
      rightToast.style.animation = '';
    }, 500);
    toastTimeout = null;
  }, 10000);
}

/* إغلاق overlay عند الضغط خارج الكارت (خيار اختياري) */
shippingOverlay.addEventListener('click', (e)=> {
  if(e.target === shippingOverlay) closeShippingOverlay();
});
offerChoiceModal.addEventListener('click', (e)=> {
  if(e.target === offerChoiceModal) closeOfferChoice();
});

/* === Start === */
renderProducts(products);
updateCartUI();
</script>

</body>
</html>
